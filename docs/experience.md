# é¡¹ç›®æ ¸å¿ƒç»éªŒæŒ‡å—

æœ¬æŒ‡å—æ”¶å½•é¡¹ç›®å¼€å‘ä¸­çš„å…³é”®ç»éªŒä¸æœ€ä½³å®è·µï¼Œå¿«é€Ÿè§£å†³å¸¸è§é—®é¢˜ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

---

## ğŸ¯ æ ¸å¿ƒå¸ƒå±€ç»éªŒï¼šåŠ¨æ€ Flex å¸ƒå±€

**è¿™æ˜¯æœ¬é¡¹ç›®æœ€é‡è¦çš„ç»éªŒã€‚** æ‘’å¼ƒå›ºå®šå°ºå¯¸ï¼Œå…¨é¢ä½¿ç”¨ Flexbox åŠ¨æ€ç©ºé—´åˆ†é…ã€‚

### æ ¸å¿ƒåŸåˆ™
- **æœ€é«˜æŒ‡å¯¼åŸåˆ™**ï¼šä¸€ä¸ªå…ƒç´ è‹¥è¦ä½œä¸º Flex å­é¡¹ï¼ˆ`flex-1`ï¼‰è¿›è¡Œä¼¸ç¼©ï¼Œå…¶ç›´æ¥çˆ¶å…ƒç´ å¿…é¡»æ˜¯ Flex å®¹å™¨ï¼ˆ`display: flex`ï¼‰
- **çº¦æŸé“¾å®Œæ•´æ€§**ï¼šä»é¡¶å±‚åˆ°åº•å±‚çš„æ‰€æœ‰ç›¸å…³çˆ¶å­å…ƒç´ éƒ½å¿…é¡»éµå¾ª Flex è§„åˆ™
- **é»„é‡‘ç»„åˆ**ï¼š`flex: 1` + `min-h-0`ï¼ˆæˆ– `min-w-0`ï¼‰

### å®æ–½è¦ç‚¹
```css
/* çˆ¶å®¹å™¨ */
.parent {
  display: flex;
  flex-direction: column;
  height: 100vh; /* æˆ–å…¶ä»–æ˜ç¡®é«˜åº¦ */
}

/* åŠ¨æ€å­é¡¹ */
.child {
  flex: 1;
  min-height: 0; /* å…³é”®ï¼šå…è®¸æ”¶ç¼© */
}

/* æ»šåŠ¨å®¹å™¨ */
.scrollable {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
}
```

### è°ƒè¯•æ–¹æ³•
å½“ Flex å¸ƒå±€å¤±æ•ˆæ—¶ï¼Œä»å‡ºé—®é¢˜çš„å…ƒç´ å¼€å§‹ï¼Œé€å±‚å‘ä¸Šæ£€æŸ¥çˆ¶å…ƒç´ æ˜¯å¦ä¸º `display: flex`ã€‚

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### API é›†æˆ
```typescript
// ç»Ÿä¸€ OpenAI å…¼å®¹æ ¼å¼
const config = {
  baseURL: "https://api.provider.com/v1",
  models: ["model-name"],
  apiKey: import.meta.env.VITE_API_KEY // å¿…é¡»ä½¿ç”¨ Vite ç¯å¢ƒå˜é‡
};
```

**æ ¸å¿ƒåŸåˆ™**ï¼š
- ä¸šåŠ¡é€»è¾‘ä¸APIé…ç½®åˆ†ç¦»
- åªä¼ é€’ç”¨æˆ·æ˜ç¡®é…ç½®çš„å‚æ•°ï¼Œä¸è®¾é»˜è®¤å€¼
- æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

### é”™è¯¯å¤„ç†
```typescript
try {
  await apiCall();
} catch (error) {
  console.error('[Service Error]', error); // å¼€å‘æ—¥å¿—
  throw new Error('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); // ç”¨æˆ·å‹å¥½æç¤º
}
```

### æµ‹è¯•è§„èŒƒ
```javascript
describe("åŠŸèƒ½æµ‹è¯•", () => {
  beforeEach(() => {
    testId = `test-${Date.now()}`; // å”¯ä¸€æ ‡è¯†é¿å…å†²çª
  });
  
  // LLMå‚æ•°æµ‹è¯•ï¼šæ¯ä¸ªå‚æ•°ç‹¬ç«‹æµ‹è¯•
  it("should handle temperature parameter", async () => {
    await modelManager.updateModel(configKey, {
      llmParams: { temperature: 0.7 } // åªæµ‹è¯•ä¸€ä¸ªå‚æ•°
    });
  });
});
```

**è¦ç‚¹**ï¼š
- ä½¿ç”¨åŠ¨æ€å”¯ä¸€æ ‡è¯†ç¬¦
- æ¯ä¸ªLLMå‚æ•°åˆ›å»ºç‹¬ç«‹æµ‹è¯•
- è¦†ç›–å¼‚å¸¸åœºæ™¯
- æ­£ç¡®æ¸…ç†æµ‹è¯•çŠ¶æ€

### Vue å¼€å‘æœ€ä½³å®è·µ

#### 1. å¤šæ ¹ç»„ä»¶çš„å±æ€§ç»§æ‰¿
**é—®é¢˜**ï¼šå½“ä¸€ä¸ªVueç»„ä»¶æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹æ—¶ï¼Œå®ƒæ— æ³•è‡ªåŠ¨ç»§æ‰¿çˆ¶ç»„ä»¶ä¼ é€’çš„épropå±æ€§ï¼ˆå¦‚ `class`ï¼‰ï¼Œå¹¶ä¼šäº§ç”Ÿè­¦å‘Šã€‚
**æ–¹æ¡ˆ**ï¼š
1.  åœ¨ `<script setup>` ä¸­ä½¿ç”¨ `defineOptions({ inheritAttrs: false })` ç¦ç”¨é»˜è®¤çš„å±æ€§ç»§æ‰¿è¡Œä¸ºã€‚
2.  åœ¨æ¨¡æ¿ä¸­ï¼Œå°† `v-bind="$attrs"` æ‰‹åŠ¨ç»‘å®šåˆ°ä½ å¸Œæœ›æ¥æ”¶è¿™äº›å±æ€§çš„**ç‰¹å®š**æ ¹èŠ‚ç‚¹ä¸Šã€‚
**ç¤ºä¾‹** (`OutputDisplay.vue`):
```html
<template>
  <!-- $attrs ä¼šå°† class, id ç­‰å±æ€§åº”ç”¨åˆ°æ­¤ç»„ä»¶ -->
  <OutputDisplayCore v-bind="$attrs" ... />
  <OutputDisplayFullscreen ... />
</template>

<script setup>
defineOptions({
  inheritAttrs: false,
});
</script>
```
**ä¼˜ç‚¹**ï¼šä»£ç æ„å›¾æ¸…æ™°ï¼Œé¿å…äº†ä¸ºè§£å†³é—®é¢˜è€Œæ·»åŠ ä¸å¿…è¦çš„ `<div>` åŒ…è£…å™¨ï¼ŒåŒæ—¶ç²¾ç¡®æ§åˆ¶äº†å±æ€§çš„æµå‘ã€‚

---

## ğŸš¨ å…³é”®Bugä¿®å¤ç»éªŒ

### 1. å›½é™…åŒ–(i18n)é”®å€¼åŒæ­¥
**é—®é¢˜**ï¼š`[intlify] Not found 'key' in 'locale' messages` é”™è¯¯ï¼Œé€šå¸¸ç”±ä¸­è‹±æ–‡è¯­è¨€åŒ…é”®å€¼ä¸åŒæ­¥å¼•èµ·ã€‚
**æ–¹æ¡ˆ**ï¼šæ‰‹åŠ¨æ’æŸ¥è€—æ—¶ä¸”æ˜“é”™ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„Node.jsè„šæœ¬æ¥è‡ªåŠ¨åŒ–åœ°æ¯”è¾ƒä¸¤ä¸ªè¯­è¨€æ–‡ä»¶ï¼Œå¹¶åˆ—å‡ºå·®å¼‚ã€‚
**ç¤ºä¾‹è„šæœ¬** (`scripts/check-i18n.js`):
```javascript
const fs = require('fs');

// é€’å½’å‡½æ•°ï¼Œç”¨äºä»å¯¹è±¡ä¸­æå–æ‰€æœ‰é”®è·¯å¾„
function getKeys(obj, prefix = '') { /* ... */ }

// åŠ è½½å¹¶è§£æè¯­è¨€æ–‡ä»¶å†…å®¹
function loadLangFile(filePath) { /* ... */ }

const zhKeys = new Set(loadLangFile('zh-CN.ts'));
const enKeys = new Set(loadLangFile('en-US.ts'));

const missingInZh = [...enKeys].filter(key => !zhKeys.has(key));
const missingInEn = [...zhKeys].filter(key => !enKeys.has(key));

// è¾“å‡ºå·®å¼‚æŠ¥å‘Š
console.log('Missing in zh-CN:', missingInZh);
console.log('Missing in en-US:', missingInEn);
```
**ä¼˜ç‚¹**ï¼šå¿«é€Ÿã€å‡†ç¡®åœ°å®šä½æ‰€æœ‰ç¼ºå¤±æˆ–å¤šä½™çš„ç¿»è¯‘é”®ï¼Œä¿è¯å¤šè¯­è¨€ä½“éªŒçš„ä¸€è‡´æ€§ã€‚

### 2. å‚æ•°é€æ˜åŒ–ï¼ˆ2024-12-20ï¼‰
**é—®é¢˜**ï¼šLLMå‚æ•°é»˜è®¤å€¼è¯¯å¯¼ç”¨æˆ·
```typescript
// âŒ é”™è¯¯ï¼šè‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼
if (!config.temperature) config.temperature = 0.7;

// âœ… æ­£ç¡®ï¼šåªä½¿ç”¨ç”¨æˆ·é…ç½®çš„å‚æ•°
const requestConfig = {
  model: modelConfig.defaultModel,
  messages: formattedMessages,
  ...userLlmParams // åªä¼ é€’ç”¨æˆ·æ˜ç¡®é…ç½®çš„å‚æ•°
};
```

### 3. æ•°æ®å¯¼å…¥å®‰å…¨éªŒè¯
```typescript
// ç™½åå•éªŒè¯ + ç±»å‹æ£€æŸ¥
for (const [key, value] of Object.entries(importData)) {
  if (!ALLOWED_KEYS.includes(key)) {
    console.warn(`è·³è¿‡æœªçŸ¥é…ç½®: ${key}`);
    continue;
  }
  if (typeof value !== 'string') {
    console.warn(`è·³è¿‡æ— æ•ˆç±»å‹ ${key}: ${typeof value}`);
    continue;
  }
  await storage.setItem(key, value);
}
```

### 4. Flex çº¦æŸé“¾æ–­è£‚ä¿®å¤
**å…¸å‹é”™è¯¯**ï¼š
```html
<!-- âŒ çˆ¶å®¹å™¨ä¸æ˜¯ flexï¼Œå­å…ƒç´  flex-1 å¤±æ•ˆ -->
<div class="h-full relative">
  <TextDiff class="flex-1 min-h-0" />
</div>

<!-- âœ… æ­£ç¡®ï¼šçˆ¶å®¹å™¨å¿…é¡»æ˜¯ flex -->
<div class="h-full flex flex-col">
  <TextDiff class="flex-1 min-h-0" />
</div>
```

### 5. TestPanel å¤æ‚å“åº”å¼å¸ƒå±€ä¿®å¤ï¼ˆ2024-12-21ï¼‰

**é—®é¢˜ç°è±¡**ï¼šTestPanel.vue ä¸­çš„æµ‹è¯•ç»“æœåŒºåŸŸå­˜åœ¨ flex å¸ƒå±€é—®é¢˜ï¼Œå†…å®¹è¢«æ¨å‘ä¸Šæ–¹è€Œéæ­£ç¡®å ç”¨å¯ç”¨ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å°å±æ¨¡å¼ä¸‹ä½¿ç”¨å‚ç›´å †å å¸ƒå±€æ—¶ã€‚

**æ ¹æœ¬åŸå› **ï¼š
1. **é«˜åº¦çº¦æŸä¼ é€’ä¸å®Œæ•´**ï¼šflex å®¹å™¨ç¼ºå°‘ `min-h-0` çº¦æŸï¼Œå¯¼è‡´å­é¡¹æ— æ³•æ­£ç¡®ç¼©å°
2. **æ··åˆå¸ƒå±€æ¨¡å¼å¤„ç†ä¸å½“**ï¼šå¤§å±ä½¿ç”¨ç»å¯¹å®šä½ï¼Œå°å±ä½¿ç”¨ flex å¸ƒå±€ï¼Œä½†ä¸¤ç§æ¨¡å¼ä¸‹çš„é«˜åº¦çº¦æŸè§„åˆ™ä¸ä¸€è‡´
3. **æ ‡é¢˜å…ƒç´ å‚ä¸ç©ºé—´åˆ†é…**ï¼šh3 æ ‡é¢˜æœªæ ‡è®°ä¸º `flex-none`ï¼Œé”™è¯¯åœ°å‚ä¸äº† flex ç©ºé—´åˆ†é…

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```html
<!-- ä¿®å¤å‰ï¼šç¼ºå°‘å…³é”®çš„ min-h-0 çº¦æŸ -->
<div class="flex flex-col transition-all duration-300 min-h-[80px]">
  <h3 class="text-lg font-semibold theme-text truncate mb-3">æ ‡é¢˜</h3>
  <OutputDisplay class="flex-1" />
</div>

<!-- ä¿®å¤åï¼šå®Œæ•´çš„ flex çº¦æŸé“¾ -->
<div class="flex flex-col min-h-0 transition-all duration-300 min-h-[80px]">
  <h3 class="text-lg font-semibold theme-text truncate mb-3 flex-none">æ ‡é¢˜</h3>
  <OutputDisplay class="flex-1 min-h-0" />
</div>
```

**å…³é”®ä¿®å¤ç‚¹**ï¼š
- ä¸ºæ¯ä¸ªç»“æœå®¹å™¨æ·»åŠ  `min-h-0` çº¦æŸ
- å°†æ ‡é¢˜æ ‡è®°ä¸º `flex-none`ï¼Œé˜²æ­¢å‚ä¸ç©ºé—´åˆ†é…  
- ä¸º OutputDisplay ç»„ä»¶æ·»åŠ  `min-h-0`ï¼Œç¡®ä¿é«˜åº¦çº¦æŸæ­£ç¡®ä¼ é€’åˆ°ç»„ä»¶å†…éƒ¨

**ç»éªŒæ€»ç»“**ï¼š
- å¤æ‚å“åº”å¼å¸ƒå±€ä¸­ï¼Œæ¯ç§å¸ƒå±€æ¨¡å¼ï¼ˆflex vs absoluteï¼‰éƒ½éœ€è¦ç‹¬ç«‹éªŒè¯é«˜åº¦çº¦æŸ
- æ··åˆå¸ƒå±€æ¨¡å¼çš„ç»„ä»¶ç‰¹åˆ«å®¹æ˜“å‡ºç°çº¦æŸä¼ é€’æ–­è£‚ï¼Œéœ€è¦é€å±‚æ£€æŸ¥
- æ ‡é¢˜ç­‰å›ºå®šé«˜åº¦å…ƒç´ å¿…é¡»æ˜ç¡®æ ‡è®°ä¸º `flex-none`

### 6. UIçŠ¶æ€åŒæ­¥ä¸å“åº”å¼æ•°æ®æµæœ€ä½³å®è·µï¼ˆ2024-12-21ï¼‰

**å…¸å‹é—®é¢˜**ï¼šåœ¨å¤æ‚çš„Vueç»„ä»¶äº¤äº’ä¸­ï¼Œå­ç»„ä»¶å†…éƒ¨çŠ¶æ€çš„å˜æ›´æœªèƒ½æ­£ç¡®åæ˜ åˆ°å…¶ä»–å…„å¼Ÿç»„ä»¶ï¼Œå¯¼è‡´UIæ˜¾ç¤ºä¸åº•å±‚æ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨Aç»„ä»¶ä¸­ç¼–è¾‘å†…å®¹åï¼ŒBç»„ä»¶ï¼ˆå¦‚æµ‹è¯•é¢æ¿ï¼‰è·å–åˆ°çš„ä»ç„¶æ˜¯ç¼–è¾‘å‰çš„æ•°æ®ã€‚

**æ ¹å› åˆ†æ**ï¼šè¯¥é—®é¢˜çš„æ ¸å¿ƒåœ¨äº **å•å‘æ•°æ®æµ** ä¸ **ç»„ä»¶æœ¬åœ°çŠ¶æ€** ä¹‹é—´çš„åŒæ­¥é—´éš™ã€‚å½“ä¸€ä¸ªå­ç»„ä»¶ï¼ˆå¦‚`OutputDisplay`ï¼‰çš„å†…éƒ¨çŠ¶æ€ï¼ˆ`editingContent`ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒé€šè¿‡`emit`äº‹ä»¶é€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°é¡¶å±‚çŠ¶æ€ã€‚ç„¶è€Œï¼Œä¾èµ–åŒä¸€é¡¶å±‚çŠ¶æ€çš„å…¶ä»–å…„å¼Ÿç»„ä»¶ï¼ˆå¦‚`TestPanel`ï¼‰æ¥æ”¶åˆ°çš„`props`æ˜¯é™æ€çš„ï¼Œä¸ä¼šè‡ªåŠ¨å“åº”ç”±`emit`è§¦å‘çš„é—´æ¥çŠ¶æ€å˜æ›´ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸åŒæ­¥ã€‚

```mermaid
graph TD
    subgraph App.vue (é¡¶å±‚çŠ¶æ€)
        A[state: optimizedPrompt]
    end

    subgraph "å­/å…„å¼Ÿç»„ä»¶"
        B(OutputDisplay)
        C(TestPanel)
    end

    A -- "Props (v-model)" --> B
    A -- "Props (é™æ€ä¼ é€’)" --> C

    B -- "1. ç”¨æˆ·ç¼–è¾‘è§¦å‘å†…éƒ¨çŠ¶æ€å˜æ›´" --> B_InternalState(Local state: editingContent)
    B_InternalState -- "2. emit('update:content')" --> A
    A -- "3. é¡¶å±‚çŠ¶æ€æ›´æ–°" --> A
    
    C -- "4. ç”¨æˆ·æ“ä½œè§¦å‘" --> C_InternalState(props.optimizedPrompt ä»ä¸ºæ—§å€¼)
    
    subgraph "é—®é¢˜"
        D{Cç»„ä»¶æ•°æ®æœªåŒæ­¥}
    end

    C_InternalState -- "ä½¿ç”¨æ—§æ•°æ®æ‰§è¡Œæ“ä½œ" --> D
```

---

#### è§£å†³æ–¹æ¡ˆï¼šæ„å»ºå¯é çš„å“åº”å¼æ•°æ®æµæ¶æ„

**æ ¸å¿ƒç›®æ ‡**ï¼šç¡®ä¿ä»»ä½•æºäºç”¨æˆ·äº¤äº’çš„çŠ¶æ€å˜æ›´ï¼Œéƒ½èƒ½**ç«‹å³ã€å•å‘åœ°**åŒæ­¥å›å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰ï¼Œå¹¶ä½¿æ‰€æœ‰ä¾èµ–è¯¥æ•°æ®æºçš„ç»„ä»¶éƒ½èƒ½è‡ªåŠ¨å“åº”æ›´æ–°ã€‚

**å®æ–½æ¨¡å¼**:

1.  **æ¨¡å¼ä¸€ï¼šå®æ—¶çŠ¶æ€æå‡ (Real-time State Hoisting)**

    å­ç»„ä»¶ä¸åº”æŒæœ‰ä¸´æ—¶çš„ã€æœªåŒæ­¥çš„"è‰ç¨¿"çŠ¶æ€ã€‚ä»»ä½•å¯ç¼–è¾‘çš„çŠ¶æ€éƒ½åº”åœ¨å˜æ›´çš„ç¬é—´é€šè¿‡`emit`äº‹ä»¶å‘ä¸ŠåŒæ­¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…æŸä¸ªç‰¹å®šåŠ¨ä½œï¼ˆå¦‚"ä¿å­˜"æˆ–"å¤±ç„¦"ï¼‰è§¦å‘ã€‚

    ```typescript
    // å­ç»„ä»¶ï¼šOutputDisplayCore.vue
    // é€šè¿‡ watch å®æ—¶å°†å†…éƒ¨ç¼–è¾‘å†…å®¹åŒæ­¥åˆ°çˆ¶çº§
    watch(editingContent, (newContent) => {
      if (isEditing.value) {
        emit('update:content', newContent);
      }
    }, { immediate: false });
    ```

2.  **æ¨¡å¼äºŒï¼šæ—¶åºä¸ç«æ€æ§åˆ¶ (Timing and Race Condition Control)**

    å¯¹äºéœ€è¦æ¸…ç©ºæˆ–é‡ç½®çŠ¶æ€çš„å¼‚æ­¥æ“ä½œï¼ˆå¦‚å¼€å§‹æµå¼åŠ è½½ï¼‰ï¼Œå¿…é¡»ç¡®ä¿çŠ¶æ€å˜æ›´æ“ä½œï¼ˆå¦‚é€€å‡ºç¼–è¾‘ã€æ¸…ç©ºå†…å®¹ï¼‰åœ¨å¼‚æ­¥ä»»åŠ¡å¯åŠ¨å‰å®Œæˆã€‚`nextTick` æ˜¯è§£å†³æ­¤ç±»DOMæ›´æ–°ä¸çŠ¶æ€å˜æ›´ç«æ€é—®é¢˜çš„å…³é”®ã€‚

    ```typescript
    // çŠ¶æ€ç®¡ç†æ–¹ï¼šusePromptOptimizer.ts
    async function handleOptimize() {
        isOptimizing.value = true;
        optimizedPrompt.value = ''; // 1. åŒæ­¥æ¸…ç©ºçŠ¶æ€
        await nextTick();          // 2. ç­‰å¾…DOMå’ŒçŠ¶æ€æ›´æ–°å®Œæˆ
        
        // 3. å¯åŠ¨å¼‚æ­¥æœåŠ¡
        await promptService.value.optimizePromptStream(...);
    }
    ```
   
3.  **æ¨¡å¼ä¸‰ï¼šå¤–éƒ¨äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€é‡ç½®**

    å½“ä¸€ä¸ªåŠ¨ä½œï¼ˆå¦‚ä¼˜åŒ–ï¼‰éœ€è¦å½±å“å…„å¼Ÿç»„ä»¶çš„çŠ¶æ€ï¼ˆå¦‚å¼ºåˆ¶é€€å‡ºç¼–è¾‘ï¼‰æ—¶ï¼Œåº”é€šè¿‡é¡¶å±‚ç»„ä»¶çš„ç›‘å¬ä¸æ–¹æ³•è°ƒç”¨ï¼ˆ`ref.method()`ï¼‰æ¥å®ç°ï¼Œè€Œä¸æ˜¯è®©ç»„ä»¶é—´ç›´æ¥é€šä¿¡ã€‚

    ```typescript
    // çˆ¶ç»„ä»¶ï¼šPromptPanel.vue
    // ç›‘å¬é¡¶å±‚çŠ¶æ€å˜åŒ–ï¼Œè°ƒç”¨å­ç»„ä»¶æ–¹æ³•
    watch(() => props.isOptimizing, (newVal) => {
      if (newVal) {
        outputDisplayRef.value?.forceExitEditing();
      }
    });
    ```

#### æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **å•ä¸€æ•°æ®æº (Single Source of Truth)**ï¼šä»»ä½•å…±äº«çŠ¶æ€éƒ½å¿…é¡»ç”±å”¯ä¸€çš„ã€é«˜é˜¶çš„ç»„ä»¶æˆ–çŠ¶æ€ç®¡ç†å™¨æ‹¥æœ‰ã€‚å­ç»„ä»¶åªèƒ½é€šè¿‡`props`æ¥æ”¶å’Œé€šè¿‡`emit`è¯·æ±‚å˜æ›´ã€‚
- **å“åº”å¼æ•°æ®æµé—­ç¯**ï¼šç¡®ä¿"ç”¨æˆ·è¾“å…¥ -> `emit` -> æ›´æ–°é¡¶å±‚çŠ¶æ€ -> `props` -> æ›´æ–°æ‰€æœ‰ç›¸å…³å­ç»„ä»¶"è¿™ä¸ªæ•°æ®æµæ˜¯å®Œæ•´ä¸”è‡ªåŠ¨å“åº”çš„ã€‚
- **ç³»ç»ŸåŒ–è°ƒè¯•ç­–ç•¥**ï¼šå½“é‡åˆ°çŠ¶æ€ä¸åŒæ­¥é—®é¢˜æ—¶ï¼Œä»æ•°æ®æºå¤´ï¼ˆé¡¶å±‚çŠ¶æ€ï¼‰åˆ°æ¶ˆè´¹ç«¯ï¼ˆå­ç»„ä»¶Propsï¼‰é€çº§æ·»åŠ ä¸´æ—¶æ—¥å¿—ï¼Œæ˜¯å¿«é€Ÿå®šä½æ•°æ®æµ"æ–­ç‚¹"çš„æœ€æœ‰æ•ˆæ–¹æ³•ã€‚

---

## âš¡ å¿«é€Ÿé—®é¢˜æ’æŸ¥

### å¸ƒå±€é—®é¢˜
1. æ£€æŸ¥ Flex çº¦æŸé“¾æ˜¯å¦å®Œæ•´
2. ç¡®è®¤ `min-h-0` æ˜¯å¦æ·»åŠ 
3. éªŒè¯çˆ¶å®¹å™¨æ˜¯å¦ä¸º `display: flex`

### æ»šåŠ¨é—®é¢˜
1. æ£€æŸ¥æ˜¯å¦æœ‰ä¸­é—´å±‚é”™è¯¯çš„ `overflow` å±æ€§
2. ç¡®è®¤é«˜åº¦çº¦æŸæ˜¯å¦ä»é¡¶å±‚æ­£ç¡®ä¼ é€’
3. éªŒè¯æ»šåŠ¨å®¹å™¨æ˜¯å¦æœ‰æ­£ç¡®çš„ `overflow-y: auto`

### APIè°ƒç”¨é—®é¢˜
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®ï¼ˆ`VITE_` å‰ç¼€ï¼‰
2. ç¡®è®¤å‚æ•°æ˜¯å¦è¿‡åº¦è®¾ç½®é»˜è®¤å€¼
3. éªŒè¯é”™è¯¯å¤„ç†æ˜¯å¦ç”¨æˆ·å‹å¥½

### æµ‹è¯•å¤±è´¥
1. æ£€æŸ¥æµ‹è¯•IDæ˜¯å¦å”¯ä¸€
2. ç¡®è®¤æµ‹è¯•åæ˜¯å¦æ­£ç¡®æ¸…ç†çŠ¶æ€
3. éªŒè¯LLMå‚æ•°æµ‹è¯•æ˜¯å¦ç‹¬ç«‹

---

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬åŒæ­¥
```json
// package.json
{
  "scripts": {
    "version": "pnpm run version:sync && git add -A"
  }
}
```
**å…³é”®**ï¼šä½¿ç”¨ `version` é’©å­è€Œé `postversion`ï¼Œç¡®ä¿åŒæ­¥æ–‡ä»¶åŒ…å«åœ¨ç‰ˆæœ¬æäº¤ä¸­ã€‚

### æ¨¡æ¿ç®¡ç†
- **å†…ç½®æ¨¡æ¿**ï¼šä¸å¯ä¿®æ”¹ï¼Œä¸å¯å¯¼å‡º
- **ç”¨æˆ·æ¨¡æ¿**ï¼šå¯ä¿®æ”¹ï¼Œå¯¼å…¥æ—¶ç”Ÿæˆæ–°ID
- **å¯¼å…¥è§„åˆ™**ï¼šè·³è¿‡ä¸å†…ç½®æ¨¡æ¿IDé‡å¤çš„æ¨¡æ¿

### 4. æ•°ç»„å†…å®¹æ·±åº¦æ¯”è¾ƒä¿®å¤ï¼ˆ2025-01-27ï¼‰
**é—®é¢˜**ï¼šBugBot å‘ç°æ¨¡æ¿å†…å®¹æ¯”è¾ƒä½¿ç”¨å¼•ç”¨æ¯”è¾ƒè€Œéæ·±åº¦æ¯”è¾ƒ
```typescript
// âŒ é”™è¯¯ï¼šæ•°ç»„å¼•ç”¨æ¯”è¾ƒ
if (updatedTemplate.content !== currentTemplate.content) {
  // æ•°ç»„å†…å®¹ç›¸åŒä½†å¼•ç”¨ä¸åŒæ—¶ä¼šè§¦å‘ä¸å¿…è¦æ›´æ–°
}

// âœ… æ­£ç¡®ï¼šæ·±åº¦æ¯”è¾ƒå‡½æ•°
const deepCompareTemplateContent = (content1, content2) => {
  if (typeof content1 !== typeof content2) return false;
  
  if (typeof content1 === 'string') return content1 === content2;
  
  if (Array.isArray(content1) && Array.isArray(content2)) {
    if (content1.length !== content2.length) return false;
    return content1.every((item1, index) => {
      const item2 = content2[index];
      return item1.role === item2.role && item1.content === item2.content;
    });
  }
  
  return JSON.stringify(content1) === JSON.stringify(content2);
};

// ä½¿ç”¨æ·±åº¦æ¯”è¾ƒ
if (!deepCompareTemplateContent(updatedTemplate.content, currentTemplate.content)) {
  // åªæœ‰å†…å®¹çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°
}
```

**å…³é”®**ï¼šTemplate æ¥å£çš„ content å¯ä»¥æ˜¯ `string | Array<{role: string; content: string}>`ï¼Œå¿…é¡»æ”¯æŒä¸¤ç§ç±»å‹çš„æ­£ç¡®æ¯”è¾ƒã€‚

### 5. æ¨¡æ¿ç±»å‹è¿‡æ»¤å™¨éªŒè¯ä¿®å¤ï¼ˆ2025-01-27ï¼‰
**é—®é¢˜**ï¼šBugBot å‘ç° refreshTemplates å‡½æ•°å¯èƒ½é€‰æ‹©ä¸åŒ¹é…ç±»å‹è¿‡æ»¤å™¨çš„æ¨¡æ¿
```typescript
// âŒ é—®é¢˜ï¼šæ›´æ–°æ¨¡æ¿åç›´æ¥è¿”å›ï¼ŒæœªéªŒè¯ç±»å‹åŒ¹é…
if (updatedTemplate && contentChanged) {
  emit('update:modelValue', updatedTemplate)
  return // è·³è¿‡äº†ç±»å‹éªŒè¯
}

// âœ… ä¿®å¤ï¼šæ·»åŠ ç±»å‹éªŒè¯
if (updatedTemplate && contentChanged) {
  // éªŒè¯æ›´æ–°åçš„æ¨¡æ¿æ˜¯å¦è¿˜åŒ¹é…å½“å‰ç±»å‹è¿‡æ»¤å™¨
  if (updatedTemplate.metadata.templateType === props.type) {
    emit('update:modelValue', updatedTemplate)
    return
  }
  // ç±»å‹ä¸åŒ¹é…æ—¶ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘
}
```
**ä¿®å¤æ•ˆæœ**ï¼šç¡®ä¿æ¨¡æ¿é€‰æ‹©å™¨åªé€‰æ‹©åŒ¹é…å½“å‰ç±»å‹çš„æ¨¡æ¿ï¼Œé¿å…ç±»å‹ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

---

## ğŸ“ æ–‡æ¡£æ›´æ–°è§„èŒƒ

é‡åˆ°æ–°é—®é¢˜æˆ–æ‰¾åˆ°æ›´å¥½è§£å†³æ–¹æ¡ˆæ—¶ï¼Œåº”åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£ï¼š
1. åœ¨å¯¹åº”ç« èŠ‚æ·»åŠ æ–°ç»éªŒ
2. æ›´æ–°ä»£ç ç¤ºä¾‹
3. è®°å½•ä¿®å¤æ—¶é—´å’Œé—®é¢˜èƒŒæ™¯
4. ä¿æŒæ–‡æ¡£ç®€æ´æ€§ï¼Œé¿å…è¿‡åº¦è¯¦ç»†çš„è¿‡ç¨‹æè¿°

---

**è®°ä½**ï¼šå¥½çš„ç»éªŒæ–‡æ¡£åº”è¯¥èƒ½è®©å›¢é˜Ÿæˆå‘˜å¿«é€Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯é‡æ–°è¸©å‘ã€‚

## 7. UI ä¸»é¢˜ç³»ç»Ÿä¸ç¬¬ä¸‰æ–¹åº“æ ·å¼å†²çªå¤„ç†

**é—®é¢˜åœºæ™¯**: åœ¨å¼€å‘å¤šä¸»é¢˜åŠŸèƒ½ï¼ˆç‰¹åˆ«æ˜¯ç´«è‰²ã€ç»¿è‰²ç­‰è‡ªå®šä¹‰æ·±è‰²ä¸»é¢˜ï¼‰æ—¶ï¼Œå‘ç°é›†æˆäº† Tailwind Typography (`prose`) æ’ä»¶çš„ Markdown æ¸²æŸ“ç»„ä»¶ï¼Œå…¶èƒŒæ™¯å’Œæ–‡æœ¬é¢œè‰²æ— æ³•æ­£ç¡®åº”ç”¨ä¸»é¢˜è‰²ï¼Œè€Œæ˜¯è¢«è¦†ç›–ä¸ºä¸åè°ƒçš„äº®è‰²æ ·å¼ï¼ˆå¦‚ç™½è‰²èƒŒæ™¯ï¼‰ã€‚

**æ ¹æœ¬åŸå› åˆ†æ**:

é—®é¢˜çš„æ ¸å¿ƒåœ¨äºé¡¹ç›®è‡ªå®šä¹‰çš„ã€åŸºäº `data-theme` å±æ€§çš„é¢œè‰²ä¸»é¢˜ç³»ç»Ÿï¼Œä¸ Tailwind Typography (`prose`) æ’ä»¶é¢„è®¾çš„ã€è‡ªæˆä½“ç³»çš„é¢œè‰²æ–¹æ¡ˆå‘ç”Ÿäº†ç›´æ¥å†²çªã€‚

1.  **`prose` çš„å¼ºä¸»å¼ **: `@tailwindcss/typography` æ’ä»¶ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¸ƒå±€å·¥å…·ï¼Œå®ƒä¼šä¸º HTML å†…å®¹æ³¨å…¥ä¸€å¥—å®Œæ•´çš„è§†è§‰æ–¹æ¡ˆï¼Œå…¶ä¸­**åŒ…å«äº†å›ºå®šçš„é¢œè‰²ã€å­—ä½“ã€èƒŒæ™¯ç­‰æ ·å¼**ã€‚
2.  **é»˜è®¤äº®è‰²åå¥½**: `prose` çš„é»˜è®¤é…ç½®ï¼ˆå¦‚ `prose-stone`ï¼‰æ˜¯ä¸ºäº®è‰²èƒŒæ™¯è®¾è®¡çš„ï¼Œå®ƒä¼šå¼ºåˆ¶è®¾å®šæ·±è‰²çš„æ–‡æœ¬é¢œè‰²ã€‚
3.  **`dark:` æ¨¡å¼çš„å±€é™æ€§**: `prose` çš„é¢œè‰²åè½¬æœºåˆ¶ (`dark:prose-invert`) å¼ºä¾èµ–äº `<html>` æ ‡ç­¾ä¸Šçš„ `dark` ç±»ã€‚æˆ‘ä»¬è‡ªå®šä¹‰çš„æ·±è‰²ä¸»é¢˜ï¼ˆå¦‚ `data-theme="purple"`ï¼‰è™½ç„¶è§†è§‰ä¸Šæ˜¯æ·±è‰²çš„ï¼Œä½†å¹¶æœªè§¦å‘ Tailwind çš„ `dark` æ¨¡å¼ï¼Œå› æ­¤ `prose` ä¾ç„¶åº”ç”¨å…¶é»˜è®¤çš„äº®è‰²æ ·å¼ï¼Œå¯¼è‡´äº†é¢œè‰²è¦†ç›–ã€‚

**è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µ**:

é¢å¯¹è¿™ç§å¼ºæ ·å¼ä¸»å¼ çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¿…é¡»é‡‡å–**å½»åº•éš”ç¦»**çš„ç­–ç•¥ï¼Œä¸èƒ½è¯•å›¾"æ··åˆ"ä½¿ç”¨ã€‚

1.  **ç¦æ­¢éƒ¨åˆ†åº”ç”¨**: å®è·µè¯æ˜ï¼Œè¯•å›¾é€šè¿‡ `@apply prose-sm` ç­‰æ–¹å¼åª"å€Ÿç”¨" `prose` çš„å¸ƒå±€åŠŸèƒ½æ˜¯è¡Œä¸é€šçš„ã€‚è¿™ä¾ç„¶ä¼šå¼•å…¥æˆ‘ä»¬ä¸å¸Œæœ›çš„é¢œè‰²æ ·å¼ï¼Œå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¦†ç›–é—®é¢˜ã€‚

2.  **æ‰‹åŠ¨é‡å»ºå¸ƒå±€**: æœ€ç¨³å¥çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨éœ€è¦åº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜çš„ç»„ä»¶ä¸­ï¼Œ**å®Œå…¨ç§»é™¤** `@apply prose` æˆ–å…¶ä»»ä½•å˜ä½“ã€‚ç„¶åï¼Œå‚è€ƒ `prose` çš„æ–‡æ¡£æˆ–é»˜è®¤æ ·å¼ï¼Œ**æ‰‹åŠ¨ä¸ºå„ä¸ª Markdown å…ƒç´  (`h1`, `p`, `ul` ç­‰) æ·»åŠ çº¯ç²¹çš„ã€ä¸åŒ…å«é¢œè‰²çš„å¸ƒå±€å’Œé—´è·æ ·å¼**ã€‚

3.  **æ§åˆ¶æƒå½’è¿˜**: é€šè¿‡æ‰‹åŠ¨é‡å»ºå¸ƒå±€ï¼Œæˆ‘ä»¬å°†æ ·å¼çš„æ§åˆ¶æƒå®Œå…¨æ”¶å½’åˆ°è‡ªå·±çš„ä¸»é¢˜ç³»ç»Ÿä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨å„ä¸ªä¸»é¢˜ä¸‹ä¸ºå…ƒç´ å®šä¹‰çš„é¢œè‰²ã€èƒŒæ™¯ã€è¾¹æ¡†ç­‰æ ·å¼æ‰èƒ½ä¸å—å¹²æ‰°åœ°ã€æ­£ç¡®åœ°åº”ç”¨ã€‚

**ç¤ºä¾‹ - æ‰‹åŠ¨é‡å»ºçš„ Markdown å¸ƒå±€**:

```css
/* åœ¨å…¨å±€ theme.css ä¸­å®šä¹‰ï¼Œä¸å±äºä»»ä½•ç‰¹å®šä¸»é¢˜ */
.theme-markdown-content {
  @apply max-w-none;
}

.theme-markdown-content > :first-child { @apply mt-0; }
.theme-markdown-content > :last-child { @apply mb-0; }
.theme-markdown-content h1 { @apply text-2xl font-bold my-4; }
.theme-markdown-content h2 { @apply text-xl font-semibold my-3; }
.theme-markdown-content p { @apply my-3 leading-relaxed; }
.theme-markdown-content ul,
.theme-markdown-content ol { @apply my-3 pl-6 space-y-2; }
.theme-markdown-content pre { @apply my-4 p-4 rounded-lg text-sm; }
/* ... etc ... */
```
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ—¢ä¿ç•™äº†ä¼˜ç¾çš„æ’ç‰ˆï¼Œåˆç¡®ä¿äº†è‡ªå®šä¹‰ä¸»é¢˜çš„é¢œè‰²èƒ½å¤Ÿæ­£ç¡®æ¸²æŸ“ã€‚

## 8. Vue Composable æ¶æ„é‡æ„ï¼šè§£å†³å¼‚æ­¥åˆå§‹åŒ–é—®é¢˜

### é—®é¢˜èƒŒæ™¯
åœ¨å¼‚æ­¥å›è°ƒä¸­è°ƒç”¨Vue Composableå‡½æ•°ä¼šå¯¼è‡´é”™è¯¯ï¼š`Uncaught (in promise) SyntaxError: Must be called at the top of a 'setup' function`ã€‚è¿™è¿åäº†Vue Composition APIçš„æ ¸å¿ƒè§„åˆ™ï¼Œéœ€è¦é‡æ„æ¶æ„ã€‚

### æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼šé¡¶å±‚å£°æ˜ï¼Œå“åº”å¼è¿æ¥ï¼Œå†…éƒ¨è‡ªæ²»
```typescript
// âŒ é”™è¯¯ï¼šåœ¨å¼‚æ­¥å›è°ƒä¸­è°ƒç”¨Composable
onMounted(async () => {
  const services = await initServices();
  const modelManager = useModelManager(); // é”™è¯¯ï¼šä¸åœ¨setupé¡¶å±‚è°ƒç”¨
});

// âœ… æ­£ç¡®ï¼šé¡¶å±‚å£°æ˜ï¼Œå“åº”å¼è¿æ¥
const { services } = useAppInitializer(); // åœ¨é¡¶å±‚è°ƒç”¨
const modelManager = useModelManager(services); // åœ¨é¡¶å±‚è°ƒç”¨ï¼Œä¼ å…¥serviceså¼•ç”¨

// å†…éƒ¨å®ç°ï¼šå“åº”å¼è¿æ¥
export function useModelManager(services: Ref<AppServices | null>) {
  // çŠ¶æ€å®šä¹‰...
  
  // å“åº”å¼è¿æ¥ï¼šç›‘å¬æœåŠ¡å°±ç»ª
  watch(services, (newServices) => {
    if (!newServices) return;
    // ä½¿ç”¨å·²å°±ç»ªçš„æœåŠ¡...
  }, { immediate: true });
  
  return { /* è¿”å›çŠ¶æ€å’Œæ–¹æ³• */ };
}
```

### æ¶æ„è®¾è®¡è¦ç‚¹
1. **ç»Ÿä¸€æœåŠ¡æ¥å£**ï¼šåˆ›å»º`AppServices`æ¥å£ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ ¸å¿ƒæœåŠ¡
   ```typescript
   // packages/ui/src/types/services.ts
   export interface AppServices {
     storageProvider: IStorageProvider;
     modelManager: IModelManager;
     templateManager: ITemplateManager;
     historyManager: IHistoryManager;
     dataManager: DataManager;
     llmService: ILLMService;
     promptService: IPromptService;
   }
   ```

2. **æœåŠ¡åˆå§‹åŒ–å™¨**ï¼š`useAppInitializer`è´Ÿè´£åˆ›å»ºå’Œåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡
   ```typescript
   // è¿”å›å¸¦æœ‰é”™è¯¯å¤„ç†çš„æœåŠ¡å¼•ç”¨
   export function useAppInitializer() {
     const services = ref<AppServices | null>(null);
     const isInitializing = ref(true);
     const error = ref<Error | null>(null);
     
     onMounted(async () => {
       try {
         // åˆå§‹åŒ–æœåŠ¡...
         services.value = { /* æœåŠ¡å®ä¾‹ */ };
       } catch (err) {
         error.value = err instanceof Error ? err : new Error(String(err));
       } finally {
         isInitializing.value = false;
       }
     });
     
     return { services, isInitializing, error };
   }
   ```

3. **Composableå‚æ•°æ¨¡å¼**ï¼šæ‰€æœ‰Composableæ¥æ”¶`services`å¼•ç”¨ä½œä¸ºå‚æ•°
   ```typescript
   export function useModelManager(services: Ref<AppServices | null>) {
     // ...
   }
   
   export function useTemplateManager(services: Ref<AppServices | null>) {
     // ...
   }
   ```

### å…³é”®ç»éªŒ
1. **Vueå“åº”å¼ä¸Šä¸‹æ–‡**: Vue Composableå¿…é¡»åœ¨`<script setup>`é¡¶å±‚åŒæ­¥è°ƒç”¨ï¼Œå¼‚æ­¥å›è°ƒä¸­è°ƒç”¨ä¼šå¯¼è‡´é”™è¯¯
2. **å“åº”å¼è¿æ¥æ¨¡å¼**: ä½¿ç”¨`watch`ç›‘å¬æœåŠ¡å°±ç»ªï¼Œè€Œä¸æ˜¯åœ¨å›è°ƒä¸­è°ƒç”¨Composable
3. **å¿«é€Ÿå¤±è´¥åŸåˆ™**: åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¿«é€Ÿæš´éœ²é—®é¢˜æ¯”éšè—é—®é¢˜æ›´æœ‰ä»·å€¼ï¼Œæœ‰åŠ©äºåŠæ—©å‘ç°å’Œä¿®å¤é—®é¢˜
4. **ç»Ÿä¸€æ¶æ„**: ä¿æŒæ‰€æœ‰Composableçš„ä¸€è‡´æ¶æ„æ¨¡å¼ï¼Œæœ‰åŠ©äºä»£ç ç†è§£å’Œç»´æŠ¤
5. **ç±»å‹ç³»ç»ŸæŒ‘æˆ˜**: å¤æ‚çš„ç±»å‹ç³»ç»Ÿå¯èƒ½å¯¼è‡´æ¥å£ä¸åŒ¹é…é—®é¢˜ï¼Œéœ€è¦ä»”ç»†å¤„ç†ç±»å‹å®šä¹‰å’Œå®ç°

### å®æ–½å»ºè®®
- æ‰€æœ‰Composableåœ¨`<script setup>`é¡¶å±‚è°ƒç”¨
- ä½¿ç”¨`watch`ç›‘å¬æœåŠ¡å°±ç»ªï¼Œè€Œä¸æ˜¯åœ¨å›è°ƒä¸­è°ƒç”¨Composable
- ä½¿ç”¨TypeScriptéç©ºæ–­è¨€æ“ä½œç¬¦`!`å¿«é€Ÿæš´éœ²æ½œåœ¨é—®é¢˜
- ç»Ÿä¸€æœåŠ¡æ¥å£å’Œå‚æ•°æ¨¡å¼ï¼Œæé«˜ä»£ç ä¸€è‡´æ€§
- è¯¦ç»†è®°å½•æ¶æ„å†³ç­–å’Œç»éªŒï¼Œä¾¿äºå›¢é˜ŸçŸ¥è¯†ä¼ æ‰¿

### 7. Composable é‡æ„ï¼š`reactive` vs `ref` çš„æ·±åº¦å®è·µ (2024-07-28)

**èƒŒæ™¯**: ä¸ºè§£å†³ Vue æ·±å±‚åµŒå¥— `ref` æ— æ³•è‡ªåŠ¨è§£åŒ…çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°†å¤šä¸ªæ ¸å¿ƒ Composablesï¼ˆå¦‚ `usePromptOptimizer`ï¼‰çš„è¿”å›å€¼ä»åŒ…å«å¤šä¸ª `ref` çš„å¯¹è±¡ï¼Œé‡æ„ä¸ºäº†å•ä¸€çš„ `reactive` å¯¹è±¡ã€‚æ­¤ä¸¾è™½ç„¶ç®€åŒ–äº†é¡¶å±‚çŠ¶æ€ç®¡ç†ï¼Œä½†å¼•å‘äº†ä¸€ç³»åˆ—å¤æ‚çš„è”åŠ¨é”™è¯¯ã€‚

**æ ¸å¿ƒæŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ**:

1.  **ä¾èµ–æ³¨å…¥å¤±è´¥ (`templateLanguageService`)**
    *   **ç°è±¡**: `BuiltinTemplateLanguageSwitch` ç»„ä»¶æ— æ³•é€šè¿‡ `inject` è·å– `templateLanguageService` å®ä¾‹ï¼Œå¯¼è‡´åˆå§‹åŒ–å¤±è´¥ã€‚
    *   **æ ¹å› **: `useAppInitializer.ts` åœ¨åˆå§‹åŒ–æœåŠ¡æ—¶ï¼Œè™½ç„¶åˆ›å»ºäº† `languageService`ï¼Œä½†**æ²¡æœ‰å°†å…¶æ·»åŠ åˆ°æœ€ç»ˆæä¾›ç»™æ•´ä¸ªåº”ç”¨çš„ `services` å¯¹è±¡ä¸­**ã€‚
    *   **ä¿®å¤æ­¥éª¤**:
        1.  ä¿®æ”¹ `useAppInitializer.ts`ï¼Œå°† `templateLanguageService` æ·»åŠ åˆ°è¿”å›çš„ `services` å¯¹è±¡ä¸­ã€‚
        2.  ä¿®æ”¹ `packages/ui/src/types/services.ts`ï¼Œåœ¨ `AppServices` æ¥å£ä¸­æ·»åŠ  `templateLanguageService: TemplateLanguageService` ç±»å‹å®šä¹‰ï¼Œè§£å†³ TypeScript æŠ¥é”™ã€‚
    *   **æ•™è®­**: ä¾èµ–æ³¨å…¥çš„é“¾æ¡å¿…é¡»å®Œæ•´ã€‚æœåŠ¡ä¸ä»…è¦è¢«åˆ›å»ºï¼Œè¿˜è¦è¢«æ­£ç¡®åœ°"æ³¨å†Œ"å’Œ"æä¾›"ã€‚

2.  **å“åº”å¼æ¥å£ä¸åŒ¹é… (`reactive` -> `ref`)**
    *   **ç°è±¡**: `useTemplateManager` ä¸­å‡ºç° `Cannot read properties of null (reading 'value')` é”™è¯¯ã€‚
    *   **æ ¹å› **: `useTemplateManager` æœŸæœ›æ¥æ”¶ä¸€ä¸ª `ref` ç±»å‹çš„å‚æ•° (`selectedTemplate`)ï¼Œä»¥ä¾¿èƒ½é€šè¿‡ `.value` è¿›è¡ŒåŒå‘ç»‘å®šã€‚è€Œé‡æ„åçš„ `App.vue` ç›´æ¥ä¼ é€’äº† `optimizer.selectedOptimizeTemplate`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®é€šå€¼ï¼Œè€Œé `ref`ã€‚
    *   **ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `toRef` ä½œä¸º"é€‚é…å™¨"ã€‚
        ```typescript
        // App.vue
        import { toRef } from 'vue';

        const optimizer = usePromptOptimizer(...);
        
        // ä¸º reactive å¯¹è±¡çš„å±æ€§åˆ›å»ºä¸€ä¸ªåŒå‘ç»‘å®šçš„ ref
        const selectedOptimizeTemplateRef = toRef(optimizer, 'selectedOptimizeTemplate');

        const templateManager = useTemplateManager({
            // å°†åˆ›å»ºçš„ ref ä¼ å…¥ï¼Œæ»¡è¶³ useTemplateManager çš„æ¥å£æœŸæœ›
            selectedTemplate: selectedOptimizeTemplateRef,
            // ...
        });
        ```
    *   **æ•™è®­**: åœ¨ Composable ä¹‹é—´ä¼ é€’å“åº”å¼çŠ¶æ€æ—¶ï¼Œå¿…é¡»æ³¨æ„"æ¥å£"åŒ¹é…ã€‚`toRef` æ˜¯è¿æ¥ `reactive` å¯¹è±¡å’ŒæœŸæœ› `ref` çš„æ—§ä»£ç æˆ–å­æ¨¡å—çš„å®Œç¾æ¡¥æ¢ã€‚

3.  **å¥å£®æ€§ä¿®å¤ (Vercel API æ£€æµ‹)**
    *   **ç°è±¡**: æ§åˆ¶å°å‡ºç° `Vercel API detection failed SyntaxError: Unexpected token '<'` è­¦å‘Šã€‚
    *   **æ ¹å› **: `environment.ts` ä¸­çš„æ£€æµ‹å‡½æ•°åœ¨æœåŠ¡ç«¯è¿”å› HTML é”™è¯¯é¡µé¢ï¼ˆè€Œé JSONï¼‰æ—¶ï¼Œä¾ç„¶å°è¯•è°ƒç”¨ `response.json()`ï¼Œå¯¼è‡´è§£æå¤±è´¥ã€‚
    *   **ä¿®å¤**: åœ¨è§£æå‰å¢åŠ  `Content-Type` å“åº”å¤´æ£€æŸ¥ï¼Œç¡®ä¿åªåœ¨å†…å®¹ä¸º `application/json` æ—¶æ‰æ‰§è¡Œè§£æã€‚
    *   **æ•™è®­**: æ‰€æœ‰ä¸å¤–éƒ¨ API çš„äº¤äº’éƒ½åº”å‡å®šå¯èƒ½å¤±è´¥ã€‚åœ¨è§£æå“åº”å‰ï¼ŒåŠ¡å¿…æ£€æŸ¥å…¶å†…å®¹ç±»å‹å’ŒçŠ¶æ€ç ã€‚

**æ€»ç»“**: æœ¬æ¬¡é‡æ„æ·±åˆ»æ­ç¤ºäº† Vue 3 å“åº”å¼ç³»ç»Ÿçš„å‡ ä¸ªå…³é”®ç‚¹ï¼š
- `reactive` é€‚ç”¨äºç®¡ç†**ä¸€ç»„**ç›¸å…³çŠ¶æ€ï¼Œç®€åŒ–é¡¶å±‚ APIã€‚
- `ref` ä¾ç„¶æ˜¯è·¨ç»„ä»¶æˆ– Composable è¾¹ç•Œä¼ é€’**å•ä¸ª**å“åº”å¼å˜é‡çš„å¯é æ–¹å¼ã€‚
- `toRef` å’Œ `toRefs` æ˜¯åœ¨ `reactive` å’Œ `ref` ä¹‹é—´æ— ç¼åˆ‡æ¢ã€é€‚é…æ–°æ—§ä»£ç çš„å¿…å¤‡å·¥å…·ã€‚
- ä¾èµ–æ³¨å…¥å’ŒæœåŠ¡åˆå§‹åŒ–æµç¨‹çš„æ­£ç¡®æ€§ï¼Œæ˜¯å¤æ‚åº”ç”¨ç¨³å®šè¿è¡Œçš„åŸºçŸ³ã€‚
