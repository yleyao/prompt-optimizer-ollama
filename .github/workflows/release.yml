name: Release Desktop Apps

on:
  push:
    tags:
      - 'v*.*.*'        # æ­£å¼ç‰ˆæœ¬: v1.0.0, v2.1.3
      - 'v*.*.*-*'      # é¢„è§ˆç‰ˆæœ¬: v1.0.0-beta.1, v1.0.0-rc.1

env:
  NODE_VERSION: '22'
  PNPM_VERSION: '10.6.1'

jobs:
  # æž„å»º Windows ç‰ˆæœ¬
  build-windows:
    runs-on: windows-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: å®‰è£… pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}
          run_install: false

      - name: è®¾ç½® Node.js çŽ¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: åŠ¨æ€é…ç½® package.json
        shell: pwsh
        run: |
          $pkgPath = "packages/desktop/package.json"
          $pkgJson = Get-Content $pkgPath -Raw | ConvertFrom-Json

          # 1. ä»Ž Git æ ‡ç­¾æå–ç‰ˆæœ¬å· (ç§»é™¤ 'v' å‰ç¼€)
          $tagVersion = "${{ github.ref }}".replace("refs/tags/v", "")
          $pkgJson.version = $tagVersion
          Write-Host "âœ… Set version to: $tagVersion"

          # 2. è®¾ç½®ä»“åº“åœ°å€ (è‡ªåŠ¨æ„ŸçŸ¥å½“å‰ä»“åº“)
          $repoUrl = "https://github.com/${{ github.repository }}.git"
          $pkgJson.repository.url = $repoUrl
          Write-Host "âœ… Set repository URL to: $repoUrl"

          # 3. åˆ¤æ–­ç‰ˆæœ¬ç±»åž‹å¹¶è®¾ç½®å‘å¸ƒé…ç½®
          $isPrivate = $False
          $isPrerelease = $False
          $versionType = "release"

          # æ£€æŸ¥æ˜¯å¦ä¸ºç§æœ‰ä»“åº“ (é€šè¿‡ Token æ˜¯å¦å­˜åœ¨åˆ¤æ–­)
          if ("${{ secrets.GH_TOKEN_FOR_UPDATER }}" -ne "") {
            $isPrivate = $True
            Write-Host "ðŸ”’ Detected private repository"
          } else {
            Write-Host "ðŸŒ Detected public repository"
          }

          # æ£€æŸ¥ç‰ˆæœ¬ç±»åž‹
          if ($tagVersion -match "-(alpha|beta|rc)") {
            $isPrerelease = $True
            $versionType = "prerelease"
            Write-Host "ðŸ§ª Detected prerelease version"
          } elseif ($tagVersion -match "-(hotfix|patch)") {
            $isPrerelease = $False
            $versionType = "hotfix"
            Write-Host "ðŸ”§ Detected hotfix version"
          } else {
            $isPrerelease = $False
            $versionType = "release"
            Write-Host "ðŸš€ Detected stable release version"
          }

          # 4. è®¾ç½® publish é…ç½®
          $publishConfig = @{ 
            provider = "github"
            private = $isPrivate
          }
          $pkgJson.build.publish = $publishConfig
          Write-Host "âœ… Set publish config (private: $isPrivate)"

          # 5. å°†ä¿®æ”¹å†™å›žæ–‡ä»¶
          $pkgJson | ConvertTo-Json -Depth 10 | Set-Content $pkgPath -Encoding UTF8
          Write-Host "âœ… package.json updated successfully"

          # 6. è¾“å‡ºé…ç½®æ‘˜è¦
          Write-Host ""
          Write-Host "ðŸ“‹ Configuration Summary:"
          Write-Host "   Version: $tagVersion"
          Write-Host "   Type: $versionType"
          Write-Host "   Repository: $repoUrl"
          Write-Host "   Private: $isPrivate"
          Write-Host "   Prerelease: $isPrerelease"

      - name: å®‰è£…ä¾èµ–
        run: pnpm install

      - name: æž„å»º Desktop åº”ç”¨
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN_FOR_UPDATER }}
        run: pnpm build:desktop

      - name: éªŒè¯æž„å»ºäº§ç‰©
        shell: bash
        run: |
          echo "Checking build artifacts..."
          ls -la packages/desktop/dist/ || echo "No dist directory found"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æž„å»ºäº§ç‰©
          exe_files=$(find packages/desktop/dist -name "*.exe" 2>/dev/null | wc -l)
          zip_files=$(find packages/desktop/dist -name "*.zip" 2>/dev/null | wc -l)
          
          echo "Found $exe_files .exe files and $zip_files .zip files"
          
          if [ "$exe_files" -eq 0 ] && [ "$zip_files" -eq 0 ]; then
            echo "Error: No build artifacts (.exe or .zip) found in packages/desktop/dist/"
            echo "Directory contents:"
            find packages/desktop/dist -type f 2>/dev/null || echo "Directory not found or empty"
            exit 1
          fi
          
          echo "Build artifacts verification passed"

      - name: ä¸Šä¼  Windows æž„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: windows-build
          path: |
            packages/desktop/dist/PromptOptimizer-*.exe
            packages/desktop/dist/PromptOptimizer-*.zip
            packages/desktop/dist/latest*.yml
          retention-days: 30

  # æž„å»º macOS ç‰ˆæœ¬
  build-macos:
    runs-on: macos-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: å®‰è£… pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}
          run_install: false

      - name: è®¾ç½® Node.js çŽ¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: åŠ¨æ€é…ç½® package.json
        run: |
          PKG_PATH="packages/desktop/package.json"
          
          # 1. ä»Ž Git æ ‡ç­¾æå–ç‰ˆæœ¬å· (ç§»é™¤ 'v' å‰ç¼€)
          TAG_VERSION="${{ github.ref }}"
          TAG_VERSION="${TAG_VERSION#refs/tags/v}"
          echo "âœ… Set version to: $TAG_VERSION"
          
          # 2. è®¾ç½®ä»“åº“åœ°å€ (è‡ªåŠ¨æ„ŸçŸ¥å½“å‰ä»“åº“)
          REPO_URL="https://github.com/${{ github.repository }}.git"
          echo "âœ… Set repository URL to: $REPO_URL"
          
          # 3. åˆ¤æ–­ç‰ˆæœ¬ç±»åž‹å¹¶è®¾ç½®å‘å¸ƒé…ç½®
          IS_PRIVATE=false
          IS_PRERELEASE=false
          VERSION_TYPE="release"
          
          # æ£€æŸ¥æ˜¯å¦ä¸ºç§æœ‰ä»“åº“ (é€šè¿‡ Token æ˜¯å¦å­˜åœ¨åˆ¤æ–­)
          if [ -n "${{ secrets.GH_TOKEN_FOR_UPDATER }}" ]; then
            IS_PRIVATE=true
            echo "ðŸ”’ Detected private repository"
          else
            echo "ðŸŒ Detected public repository"
          fi
          
          # æ£€æŸ¥ç‰ˆæœ¬ç±»åž‹
          if [[ $TAG_VERSION =~ -(alpha|beta|rc) ]]; then
            IS_PRERELEASE=true
            VERSION_TYPE="prerelease"
            echo "ðŸ§ª Detected prerelease version"
          elif [[ $TAG_VERSION =~ -(hotfix|patch) ]]; then
            IS_PRERELEASE=false
            VERSION_TYPE="hotfix"
            echo "ðŸ”§ Detected hotfix version"
          else
            IS_PRERELEASE=false
            VERSION_TYPE="release"
            echo "ðŸš€ Detected stable release version"
          fi
          
          # 4. ä½¿ç”¨ jq æ›´æ–° package.json
          jq --arg version "$TAG_VERSION" \
             --arg repo_url "$REPO_URL" \
             --argjson is_private $IS_PRIVATE \
             '.version = $version | 
              .repository.url = $repo_url | 
              .build.publish = {provider: "github", private: $is_private}' \
             "$PKG_PATH" > "${PKG_PATH}.tmp" && mv "${PKG_PATH}.tmp" "$PKG_PATH"
          
          echo "âœ… package.json updated successfully"
          
          # 5. è¾“å‡ºé…ç½®æ‘˜è¦
          echo ""
          echo "ðŸ“‹ Configuration Summary:"
          echo "   Version: $TAG_VERSION"
          echo "   Type: $VERSION_TYPE"
          echo "   Repository: $REPO_URL"
          echo "   Private: $IS_PRIVATE"
          echo "   Prerelease: $IS_PRERELEASE"

      - name: å®‰è£…ä¾èµ–
        run: pnpm install

      - name: æž„å»º Desktop åº”ç”¨
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN_FOR_UPDATER }}
        run: pnpm build:desktop

      - name: éªŒè¯æž„å»ºäº§ç‰©
        run: |
          echo "Checking build artifacts..."
          ls -la packages/desktop/dist/ || echo "No dist directory found"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æž„å»ºäº§ç‰©
          dmg_files=$(find packages/desktop/dist -name "*.dmg" 2>/dev/null | wc -l)
          zip_files=$(find packages/desktop/dist -name "*.zip" 2>/dev/null | wc -l)
          
          echo "Found $dmg_files .dmg files and $zip_files .zip files"
          
          if [ "$dmg_files" -eq 0 ] && [ "$zip_files" -eq 0 ]; then
            echo "Error: No build artifacts (.dmg or .zip) found in packages/desktop/dist/"
            echo "Directory contents:"
            find packages/desktop/dist -type f 2>/dev/null || echo "Directory not found or empty"
            exit 1
          fi
          
          echo "Build artifacts verification passed"

      - name: ä¸Šä¼  macOS æž„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: macos-build
          path: |
            packages/desktop/dist/*.dmg
            packages/desktop/dist/*.zip
            packages/desktop/dist/*.yml
          retention-days: 30

  # æž„å»º Linux ç‰ˆæœ¬
  build-linux:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: å®‰è£… pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}
          run_install: false

      - name: è®¾ç½® Node.js çŽ¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: åŠ¨æ€é…ç½® package.json
        run: |
          PKG_PATH="packages/desktop/package.json"
          
          # 1. ä»Ž Git æ ‡ç­¾æå–ç‰ˆæœ¬å· (ç§»é™¤ 'v' å‰ç¼€)
          TAG_VERSION="${{ github.ref }}"
          TAG_VERSION="${TAG_VERSION#refs/tags/v}"
          echo "âœ… Set version to: $TAG_VERSION"
          
          # 2. è®¾ç½®ä»“åº“åœ°å€ (è‡ªåŠ¨æ„ŸçŸ¥å½“å‰ä»“åº“)
          REPO_URL="https://github.com/${{ github.repository }}.git"
          echo "âœ… Set repository URL to: $REPO_URL"
          
          # 3. åˆ¤æ–­ç‰ˆæœ¬ç±»åž‹å¹¶è®¾ç½®å‘å¸ƒé…ç½®
          IS_PRIVATE=false
          IS_PRERELEASE=false
          VERSION_TYPE="release"
          
          # æ£€æŸ¥æ˜¯å¦ä¸ºç§æœ‰ä»“åº“ (é€šè¿‡ Token æ˜¯å¦å­˜åœ¨åˆ¤æ–­)
          if [ -n "${{ secrets.GH_TOKEN_FOR_UPDATER }}" ]; then
            IS_PRIVATE=true
            echo "ðŸ”’ Detected private repository"
          else
            echo "ðŸŒ Detected public repository"
          fi
          
          # æ£€æŸ¥ç‰ˆæœ¬ç±»åž‹
          if [[ $TAG_VERSION =~ -(alpha|beta|rc) ]]; then
            IS_PRERELEASE=true
            VERSION_TYPE="prerelease"
            echo "ðŸ§ª Detected prerelease version"
          elif [[ $TAG_VERSION =~ -(hotfix|patch) ]]; then
            IS_PRERELEASE=false
            VERSION_TYPE="hotfix"
            echo "ðŸ”§ Detected hotfix version"
          else
            IS_PRERELEASE=false
            VERSION_TYPE="release"
            echo "ðŸš€ Detected stable release version"
          fi
          
          # 4. ä½¿ç”¨ jq æ›´æ–° package.json
          jq --arg version "$TAG_VERSION" \
             --arg repo_url "$REPO_URL" \
             --argjson is_private $IS_PRIVATE \
             '.version = $version | 
              .repository.url = $repo_url | 
              .build.publish = {provider: "github", private: $is_private}' \
             "$PKG_PATH" > "${PKG_PATH}.tmp" && mv "${PKG_PATH}.tmp" "$PKG_PATH"
          
          echo "âœ… package.json updated successfully"
          
          # 5. è¾“å‡ºé…ç½®æ‘˜è¦
          echo ""
          echo "ðŸ“‹ Configuration Summary:"
          echo "   Version: $TAG_VERSION"
          echo "   Type: $VERSION_TYPE"
          echo "   Repository: $REPO_URL"
          echo "   Private: $IS_PRIVATE"
          echo "   Prerelease: $IS_PRERELEASE"

      - name: å®‰è£…ä¾èµ–
        run: pnpm install

      - name: æž„å»º Desktop åº”ç”¨
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN_FOR_UPDATER }}
        run: pnpm build:desktop

      - name: éªŒè¯æž„å»ºäº§ç‰©
        run: |
          echo "Checking build artifacts..."
          ls -la packages/desktop/dist/ || echo "No dist directory found"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æž„å»ºäº§ç‰©
          appimage_files=$(find packages/desktop/dist -name "*.AppImage" 2>/dev/null | wc -l)
          zip_files=$(find packages/desktop/dist -name "*.zip" 2>/dev/null | wc -l)
          
          echo "Found $appimage_files .AppImage files and $zip_files .zip files"
          
          if [ "$appimage_files" -eq 0 ] && [ "$zip_files" -eq 0 ]; then
            echo "Error: No build artifacts (.AppImage or .zip) found in packages/desktop/dist/"
            echo "Directory contents:"
            find packages/desktop/dist -type f 2>/dev/null || echo "Directory not found or empty"
            exit 1
          fi
          
          echo "Build artifacts verification passed"

      - name: ä¸Šä¼  Linux æž„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: linux-build
          path: |
            packages/desktop/dist/*.AppImage
            packages/desktop/dist/*.zip
            packages/desktop/dist/*.yml
          retention-days: 30

  # åˆ›å»º GitHub Release
  create-release:
    needs: [build-windows, build-macos, build-linux]
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: èŽ·å–ç‰ˆæœ¬å·å’Œç±»åž‹
        id: version
        run: |
          VERSION=${GITHUB_REF#refs/tags/}
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Version: $VERSION"

          # è¯¦ç»†çš„ç‰ˆæœ¬ç±»åž‹åˆ¤æ–­
          IS_PRERELEASE=false
          VERSION_TYPE="release"
          RELEASE_NAME_PREFIX=""

          if [[ $VERSION =~ -(alpha|beta|rc) ]]; then
            IS_PRERELEASE=true
            VERSION_TYPE="prerelease"
            RELEASE_NAME_PREFIX="Preview "
            echo "ðŸ§ª Detected prerelease version"
          elif [[ $VERSION =~ -(hotfix|patch) ]]; then
            IS_PRERELEASE=false
            VERSION_TYPE="hotfix"
            RELEASE_NAME_PREFIX="Hotfix "
            echo "ðŸ”§ Detected hotfix version"
          else
            IS_PRERELEASE=false
            VERSION_TYPE="release"
            RELEASE_NAME_PREFIX="Release "
            echo "ðŸš€ Detected stable release version"
          fi

          echo "is_prerelease=$IS_PRERELEASE" >> $GITHUB_OUTPUT
          echo "version_type=$VERSION_TYPE" >> $GITHUB_OUTPUT
          echo "release_name_prefix=$RELEASE_NAME_PREFIX" >> $GITHUB_OUTPUT

      - name: ä¸‹è½½æ‰€æœ‰æž„å»ºäº§ç‰©
        uses: actions/download-artifact@v4
        with:
          path: ./artifacts

      - name: æ˜¾ç¤ºæž„å»ºäº§ç‰©
        run: |
          echo "æž„å»ºäº§ç‰©åˆ—è¡¨:"
          find ./artifacts -type f -name "*" | sort

      - name: ç§»é™¤è°ƒè¯•æ–‡ä»¶
        run: |
          echo "Removing debug files..."
          find ./artifacts -type f -name "builder-debug.yml" -delete
          echo "Final artifact list after cleaning:"
          find ./artifacts -type f | sort

      - name: ç”Ÿæˆ Release Notes
        id: release_notes
        run: |
          # èŽ·å–ä¸Šä¸€ä¸ªtag
          PREVIOUS_TAG=$(git tag --sort=-version:refname | grep -E '^v[0-9]+\.[0-9]+\.[0-9]+$' | head -2 | tail -1)
          CURRENT_TAG=${{ steps.version.outputs.version }}

          echo "Previous tag: $PREVIOUS_TAG"
          echo "Current tag: $CURRENT_TAG"

          # ç”ŸæˆcommitåŽ†å²ï¼ˆå¤„ç†å¤šè¡Œå’Œé•¿commitï¼‰
          if [ -n "$PREVIOUS_TAG" ]; then
            COMMITS=$(git log --pretty=format:"%s|%h" $PREVIOUS_TAG..$CURRENT_TAG | while IFS='|' read -r subject hash; do
              # æˆªæ–­è¿‡é•¿çš„commit messageï¼ˆä¿ç•™å‰80ä¸ªå­—ç¬¦ï¼‰
              if [ ${#subject} -gt 80 ]; then
                subject="${subject:0:77}..."
              fi
              echo "- $subject (\`$hash\`)"
            done)
          else
            COMMITS=$(git log --pretty=format:"%s|%h" $CURRENT_TAG | while IFS='|' read -r subject hash; do
              # æˆªæ–­è¿‡é•¿çš„commit messageï¼ˆä¿ç•™å‰80ä¸ªå­—ç¬¦ï¼‰
              if [ ${#subject} -gt 80 ]; then
                subject="${subject:0:77}..."
              fi
              echo "- $subject (\`$hash\`)"
            done)
          fi

          # æ£€æŸ¥æ˜¯å¦æœ‰commits
          if [ -z "$COMMITS" ]; then
            COMMITS="- é¦–æ¬¡å‘å¸ƒ"
          fi

          # é™åˆ¶commitsæ•°é‡ï¼ˆæœ€å¤šæ˜¾ç¤º20ä¸ªï¼‰
          COMMITS_LIMITED=$(echo "$COMMITS" | head -20)
          COMMITS_COUNT=$(echo "$COMMITS" | wc -l)

          if [ $COMMITS_COUNT -gt 20 ]; then
            COMMITS_LIMITED="$COMMITS_LIMITED

          ... ä»¥åŠå…¶ä»– $((COMMITS_COUNT - 20)) ä¸ªæäº¤"
          fi

          # æ ¹æ®ç‰ˆæœ¬ç±»åž‹è®¾ç½®ä¸åŒçš„å›¾æ ‡å’Œæè¿°
          VERSION_ICON="ðŸš€"
          VERSION_DESC="ç¨³å®šç‰ˆæœ¬"
          STABILITY_NOTE=""

          if [[ $CURRENT_TAG =~ -(alpha|beta|rc) ]]; then
            VERSION_ICON="ðŸ§ª"
            VERSION_DESC="é¢„è§ˆç‰ˆæœ¬"
            STABILITY_NOTE="

          > âš ï¸ **æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªé¢„è§ˆç‰ˆæœ¬ï¼Œå¯èƒ½åŒ…å«å®žéªŒæ€§åŠŸèƒ½ã€‚å»ºè®®åœ¨éžç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨ã€‚"
          elif [[ $CURRENT_TAG =~ -(hotfix|patch) ]]; then
            VERSION_ICON="ðŸ”§"
            VERSION_DESC="ç´§æ€¥ä¿®å¤ç‰ˆæœ¬"
            STABILITY_NOTE="

          > ðŸ”§ **ä¿®å¤ç‰ˆæœ¬**: æ­¤ç‰ˆæœ¬ä¸»è¦åŒ…å«é‡è¦é—®é¢˜çš„ä¿®å¤ï¼Œå»ºè®®å°½å¿«æ›´æ–°ã€‚"
          fi

          # åˆ›å»ºrelease notes
          cat > release_notes.md << EOF
          ## $VERSION_ICON Prompt Optimizer $CURRENT_TAG

          **ç‰ˆæœ¬ç±»åž‹**: $VERSION_DESC$STABILITY_NOTE

          ### ðŸ“¦ ä¸‹è½½
          - **Windows**: \`PromptOptimizer-*-win-x64.exe\` (å®‰è£…ç¨‹åº) æˆ– \`PromptOptimizer-*-win-x64.zip\` (ä¾¿æºç‰ˆ)
          - **macOS**: \`PromptOptimizer-*-darwin-x64.dmg\` (å®‰è£…ç¨‹åº) æˆ– \`PromptOptimizer-*-darwin-x64.zip\` (ä¾¿æºç‰ˆ)
          - **Linux**: \`PromptOptimizer-*-linux-x86_64.AppImage\` (ä¾¿æºç‰ˆ) æˆ– \`PromptOptimizer-*-linux-x64.zip\` (ä¾¿æºç‰ˆ)

          ### ðŸ”§ å®‰è£…è¯´æ˜Ž
          - **Windows**: 
            - **å®‰è£…ç¨‹åº**: ä¸‹è½½ \`.exe\` æ–‡ä»¶ï¼ŒåŒå‡»è¿è¡Œå®‰è£…å‘å¯¼
            - **ä¾¿æºç‰ˆ**: ä¸‹è½½ \`.zip\` æ–‡ä»¶ï¼Œè§£åŽ‹åŽè¿è¡Œ \`PromptOptimizer.exe\`
          - **macOS**: 
            - **å®‰è£…ç¨‹åº**: ä¸‹è½½ \`.dmg\` æ–‡ä»¶ï¼ŒåŒå‡»æŒ‚è½½åŽæ‹–æ‹½åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹
            - **ä¾¿æºç‰ˆ**: ä¸‹è½½ \`.zip\` æ–‡ä»¶ï¼Œè§£åŽ‹åŽè¿è¡Œ \`PromptOptimizer.app\`
          - **Linux**: 
            - **AppImage**: ä¸‹è½½ \`.AppImage\` æ–‡ä»¶ï¼Œæ·»åŠ æ‰§è¡Œæƒé™åŽç›´æŽ¥è¿è¡Œ
            - **ä¾¿æºç‰ˆ**: ä¸‹è½½ \`.zip\` æ–‡ä»¶ï¼Œè§£åŽ‹åŽè¿è¡Œ \`PromptOptimizer\`

          ### ðŸ“ æ›´æ–°å†…å®¹
          $COMMITS_LIMITED

          ### ðŸ”— æ›´å¤šä¿¡æ¯
          - **é¡¹ç›®ä¸»é¡µ**: [GitHub Repository](https://github.com/${{ github.repository }})
          - **é—®é¢˜åé¦ˆ**: [Issues](https://github.com/${{ github.repository }}/issues)
          - **è®¨è®ºäº¤æµ**: [Discussions](https://github.com/${{ github.repository }}/discussions)

          ---
          **æç¤º**: å¦‚æžœéœ€è¦æŸ¥çœ‹å®Œæ•´çš„æäº¤åŽ†å²ï¼Œè¯·è®¿é—® [GitHub Commits](https://github.com/\${{ github.repository }}/compare/$PREVIOUS_TAG...$CURRENT_TAG)
          EOF

          echo "Generated release notes:"
          cat release_notes.md

      - name: åˆ›å»º Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.version.outputs.version }}
          name: ${{ steps.version.outputs.release_name_prefix }}${{ steps.version.outputs.version }}
          body_path: release_notes.md
          files: |
            ./artifacts/windows-build/*
            ./artifacts/macos-build/*
            ./artifacts/linux-build/*
          draft: false
          prerelease: ${{ steps.version.outputs.is_prerelease == 'true' }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
